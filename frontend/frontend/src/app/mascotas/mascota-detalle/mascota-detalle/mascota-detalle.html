<main class=" principal" *ngIf="mascota && mascota.id">
  <div class="container my-4">

    <div class="mb-3">
      <!-- Espacio superior opcional -->
    </div>

    <div class="profile-card">
      <div class="row align-items-center">
        <div class="col-md-2 text-center">
          <img [src]="mascota.foto" 
               [alt]="'Imagen de ' + mascota.nombre" 
               class="avatar">
        </div>
        <div class="col-md-8">
          <h3 class="mb-1">{{ mascota.nombre }}</h3>
          <p class="mb-1 text-muted">
            Raza: {{ mascota.raza }} • {{ edadMascota() }} años
          </p>
          <p class="mb-0">
            <strong>Propietario:</strong> {{ mascota.dueno?.nombre }}
          </p>
        </div>
        <div class="col-md-2 text-md-end">
          <span class="badge-health">{{ mascota.estado }}</span>
        </div>
      </div>

      <hr>

      <div class="row text-center">
        <div class="col">
          <p class="mb-1 text-muted">Especie</p>
          <h6>{{ mascota.especie }}</h6>
        </div>
        <div class="col">
          <p class="mb-1 text-muted">Peso</p>
          <h6>{{ mascota.peso }} kg</h6>
        </div>
        <div class="col">
          <p class="mb-1 text-muted">Género</p>
          <h6>{{ mascota.sexo }}</h6>
        </div>
      </div>
    </div>

    <!-- Nav Tabs -->
    <ul class="nav nav-tabs mb-3" id="myTab" role="tablist">
      <li class="nav-item" role="presentation">
        <button class="nav-link active" id="info-tab" data-bs-toggle="tab" data-bs-target="#info" type="button" role="tab">
          Información
        </button>
      </li>
      <li class="nav-item" role="presentation">
        <button class="nav-link" id="historial-tab" data-bs-toggle="tab" data-bs-target="#historial" type="button" role="tab">
          Historial Médico
        </button>
      </li>
      <li class="nav-item" role="presentation">
        <button class="nav-link" id="contacto-tab" data-bs-toggle="tab" data-bs-target="#contacto" type="button" role="tab">
          Contacto
        </button>
      </li>
      <li class="nav-item" role="presentation">
        <button class="nav-link" id="citas-tab" data-bs-toggle="tab" data-bs-target="#citas" type="button" role="tab">
          Citas
        </button>
      </li>
      <li class="nav-item" role="presentation">
  <button class="nav-link" id="tratamientos-tab" data-bs-toggle="tab" data-bs-target="#tratamientos" type="button" role="tab">
    Tratamientos
  </button>
</li>

    </ul>

    <div class="tab-content">
      <!-- Información -->
      <div class="tab-pane fade show active" id="info" role="tabpanel">
        <div class="row">
          <div class="col-md-6">
           <app-info-cards
              titulo="Información Básica"
              primerSubtitulo="Nombre: "
              segundoSubtitulo="Raza: "
              tercerSubtitulo="Peso: "
              cuartoSubtitulo="Fecha de Nacimiento: "
              quintoSubtitulo="Microchip: "
              sextoSubtitulo="Estado de Salud: "
              [primerTexto]=" mascota.nombre"
              [segundoTexto]=" mascota.raza"
              [tercerTexto]=" mascota.peso + ' kg'"
              [cuartoTexto]="' '+(mascota.fechaNacimiento | date:'dd/MM/yyyy')"
              [quintoTexto]=" ' '+ mascota.microchipID"
              [sextoTexto]=" mascota.estado">
            </app-info-cards>

          </div>

          <div class="col-md-6">
            <app-info-cards
              titulo="Información Medica"
              primerSubtitulo="Vacunas: "
              segundoSubtitulo="Alergias: "
              tercerSubtitulo="Medicamentos: "
              cuartoSubtitulo="Observaciones: "
              [primeraLista]="mascota.vacunas"
              [segundaLista]="mascota.alergias"
              [tercerTexto]="'Medicamentos'"
              [cuartoTexto]="mascota.observaciones"
            >
            </app-info-cards>
            
          </div>
        </div>
      </div>

      <!-- Historial -->
      <div class="tab-pane fade" id="historial" role="tabpanel">
        <div class="profile-card">
          <h5>Historial Médico</h5>
          <ul>
            <li>consulta 1</li>
            <li>consulta 2</li>
            <li>consulta 3</li>
            <!--<li *ngFor="let consulta of mascota.consultas">{{ consulta }}</li>-->
          </ul>
        </div>
      </div>

      <!-- Contacto -->
      <div class="tab-pane fade" id="contacto" role="tabpanel">
        <div class="profile-card">
          <h5>Información del Propietario</h5>
          <p><strong>Nombre:</strong> {{ mascota.dueno?.nombre }}</p>
          <p><strong>Teléfono:</strong>{{ mascota.dueno?.telefono }}</p>
          <p><strong>Email:</strong>{{ mascota.dueno?.email }}</p>
        </div>
      </div>

      <!-- Citas -->
      <div class="tab-pane fade" id="citas" role="tabpanel">
        <div class="profile-card">
          <h5>Citas Programadas</h5>
          <ul>
            <li>Cita 1</li>
            <li>Cita 2</li>
            <li>Cita 3</li>
            <!--<li *ngFor="let cita of mascota.citas">{{ cita }}</li>-->
          </ul>
        </div>
      </div>
      <!-- Tratamientos -->
<div class="tab-pane fade" id="tratamientos" role="tabpanel" aria-labelledby="tratamientos-tab">
  <div class="profile-card">
    <h5 class="mb-3">Tratamientos</h5>

    <!-- Formulario crear tratamiento -->
    <form (ngSubmit)="crearTratamiento()" class="row g-3">
      <div class="col-md-4">
        <label class="form-label">Nombre del tratamiento</label>
        <input class="form-control" type="text" [(ngModel)]="nombreTrat" name="nombreTrat" required>
      </div>

      <div class="col-md-4">
        <label class="form-label">Medicamento</label>
        <select class="form-select" [(ngModel)]="medicamentoId" name="medicamentoId" required>
          <option [ngValue]="0" disabled>Seleccione…</option>
          <option *ngFor="let m of medicamentos" [ngValue]="m.id">{{ m.nombre }}</option>
        </select>
      </div>

      <div class="col-md-4">
        <label class="form-label">Veterinario</label>
        <select class="form-select" [(ngModel)]="veterinarioId" name="veterinarioId" required>
          <option [ngValue]="0" disabled>Seleccione…</option>
          <option *ngFor="let v of veterinarios" [ngValue]="v.id">{{ v.nombre }}</option>
        </select>
      </div>

      <div class="col-12">
        <div *ngIf="errorMsg" class="text-danger">{{ errorMsg }}</div>
        <button type="submit" class="btn btn-primary" [disabled]="guardando">Guardar tratamiento</button>
      </div>
    </form>

    <hr class="my-4">

    <!-- Tabla de tratamientos -->
    <div class="table-responsive" *ngIf="tratamientos.length; else sinTratamientos">
      <table class="table table-striped align-middle">
        <thead>
          <tr>
            <th>ID</th>
            <th>Nombre</th>
            <th>Veterinario</th>
            <th>Medicamentos</th>
            <th style="width: 1%"></th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let t of tratamientos">
            <td>{{ t.id }}</td>
            <td>{{ t.nombre }}</td>
            <td>{{ t.veterinario?.nombre || '-' }}</td>
            <td>
              <ng-container *ngIf="t.medicamentos?.length; else sinMed">
                <!--{{ t.medicamentos!.map(m => m.nombre).join(', ') }}-->
              </ng-container>
              <ng-template #sinMed>-</ng-template>
            </td>
            <td>
              <button class="btn btn-sm btn-outline-danger" (click)="eliminarTratamiento(t.id)">Eliminar</button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <ng-template #sinTratamientos>
      <p class="text-muted mb-0">No hay tratamientos aún.</p>
    </ng-template>
  </div>
</div>

    </div>

  </div>
</main>
